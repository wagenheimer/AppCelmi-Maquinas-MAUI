<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="AppCelmiPecuaria.Views.ConfiguracaoView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:buttons="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:fontAwesome="clr-namespace:FontAwesome"
    xmlns:maui="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:models="clr-namespace:AppCelmiPecuaria.Models"
    xmlns:viewmodel="clr-namespace:AppCelmiPecuaria.ViewModel"
    xmlns:views="clr-namespace:AppCelmiPecuaria.Views"
    x:DataType="viewmodel:ConfiguracaoViewModel">

    <ScrollView Background="{StaticResource ToolbarFont}">
        <VerticalStackLayout>
            <Border Padding="5,2" Style="{StaticResource ConfiguracaoHeaderBorderStyle}">
                <StackLayout Margin="0" Orientation="Horizontal">

                    <Label
                        FontFamily="FontAwesomeLight"
                        FontSize="Large"
                        Text="{x:Static fontAwesome:FontAwesomeIcons.Gear}"
                        TextColor="White"
                        VerticalOptions="Center" />

                    <Label
                        Padding="5,0"
                        FontAttributes="Bold"
                        FontSize="Header"
                        Text="{maui:Translate CONFIGURAÃ‡Ã•ES}"
                        TextColor="White"
                        VerticalOptions="Center"
                        VerticalTextAlignment="End" />



                    <Image
                        Margin="0"
                        Aspect="AspectFit"
                        HeightRequest="40"
                        HorizontalOptions="EndAndExpand"
                        Source="appicon.svg" />

                </StackLayout>
            </Border>

            <views:LanguageSelectorView />

            <!--  Campos Personalizados  -->
            <Border
                Padding="5,2"
                HeightRequest="40"
                Style="{StaticResource ConfiguracaoHeaderBorderStyleInverse}">
                <StackLayout Orientation="Horizontal">

                    <Label
                        FontAttributes="Bold"
                        FontFamily="FontAwesomeLight"
                        FontSize="Medium"
                        Text="{x:Static fontAwesome:FontAwesomeIcons.Wrench}"
                        TextColor="White"
                        VerticalOptions="Center" />

                    <Label
                        Margin="8,0,0,0"
                        FontSize="Medium"
                        Text="{maui:Translate CamposPersonalizados}"
                        TextColor="White"
                        VerticalOptions="Center" />
                </StackLayout>
            </Border>

            <Border Grid.Row="1" Margin="0,8,0,0">
                <VerticalStackLayout Spacing="8">
                    <!--  Lista de Campos  -->
                    <CollectionView
                        EmptyView="Nenhum campo personalizado."
                        ItemsSource="{Binding AppConfig.CustomFields}"
                        SelectedItem="{Binding SelectedCustomField}"
                        SelectionMode="Single">

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:CustomField">
                                <Grid
                                    Padding="8"
                                    ColumnDefinitions="*,Auto,Auto,Auto,Auto"
                                    ColumnSpacing="8">

                                    <Label
                                        Grid.Column="0"
                                        Text="{Binding Title}"
                                        VerticalOptions="Center" />

                                    <Label
                                        Grid.Column="1"
                                        FontSize="Micro"
                                        Text="{Binding FieldType}"
                                        TextColor="{StaticResource Gray500}"
                                        VerticalOptions="Center" />

                                    <buttons:SfButton
                                        Grid.Column="2"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ConfiguracaoViewModel}}, Path=EditCustomFieldCommand}"
                                        CommandParameter="{Binding .}"
                                        HeightRequest="35"
                                        Style="{StaticResource OrangeSfButton}"
                                        Text="âœï¸"
                                        WidthRequest="35" />

                                    <buttons:SfButton
                                        Grid.Column="3"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ConfiguracaoViewModel}}, Path=ConfigureFieldOptionsCommand}"
                                        CommandParameter="{Binding .}"
                                        HeightRequest="35"
                                        IsVisible="{Binding FieldType, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='SingleChoice,MultiChoice'}"
                                        Style="{StaticResource OrangeSfButton}"
                                        Text="âš™ï¸"
                                        WidthRequest="35" />

                                    <buttons:SfButton
                                        Grid.Column="4"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ConfiguracaoViewModel}}, Path=RemoveCustomFieldCommand}"
                                        CommandParameter="{Binding .}"
                                        HeightRequest="35"
                                        Style="{StaticResource OrangeSfButton}"
                                        Text="ðŸ—‘ï¸"
                                        WidthRequest="35" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!--  BotÃ£o Adicionar  -->
                    <HorizontalStackLayout HorizontalOptions="End" Spacing="8">
                        <Button Command="{Binding AddCustomFieldCommand}" Text="Adicionar Campo" />
                    </HorizontalStackLayout>

                    <!--  Detalhes do Campo Selecionado  -->
                    <VerticalStackLayout IsVisible="{Binding SelectedCustomField, Converter={StaticResource IsNotNullConverter}}" Spacing="8">

                        <BoxView
                            HeightRequest="1"
                            HorizontalOptions="Fill"
                            Color="{StaticResource Gray300}" />

                        <Label
                            FontAttributes="Bold"
                            Text="Detalhes do Campo"
                            TextColor="{StaticResource Primary}" />

                        <Grid
                            ColumnDefinitions="Auto,*"
                            RowDefinitions="Auto,Auto,Auto"
                            RowSpacing="8">
                            <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                Text="Tipo"
                                VerticalOptions="Center" />

                            <Picker
                                Grid.Row="0"
                                Grid.Column="1"
                                ItemsSource="{Binding Source={x:Type models:CustomFieldType}, Converter={StaticResource EnumToCollectionConverter}}"
                                SelectedItem="{Binding SelectedCustomField.FieldType}" />

                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                Text="ObrigatÃ³rio"
                                VerticalOptions="Center" />

                            <CheckBox
                                Grid.Row="1"
                                Grid.Column="1"
                                IsChecked="{Binding SelectedCustomField.IsRequired}" />

                            <Label
                                Grid.Row="2"
                                Grid.Column="0"
                                Text="DescriÃ§Ã£o"
                                VerticalOptions="Start" />

                            <Entry
                                Grid.Row="2"
                                Grid.Column="1"
                                HeightRequest="80"
                                Text="{Binding SelectedCustomField.Description}" />
                        </Grid>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentView>              